RSpec.describe AbiCoderRb do
  it "uint256[2]" do
    type = "uint256[2]"
    value = [100, 200]
    data = hex "0000000000000000000000000000000000000000000000000000000000000064" \
               "00000000000000000000000000000000000000000000000000000000000000c8"
    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "uint256[]" do
    type = "uint256[]"
    value = [100, 200]
    data = hex "0000000000000000000000000000000000000000000000000000000000000002" \
               "0000000000000000000000000000000000000000000000000000000000000064" \
               "00000000000000000000000000000000000000000000000000000000000000c8"
    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(uint256[])" do
    type = "(uint256[])"
    value = [[100, 200]]
    data = hex "0000000000000000000000000000000000000000000000000000000000000020" \
               "0000000000000000000000000000000000000000000000000000000000000002" \
               "0000000000000000000000000000000000000000000000000000000000000064" \
               "00000000000000000000000000000000000000000000000000000000000000c8"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "uint" do
    type = "uint256"
    value = 98_127_491
    data = hex "0000000000000000000000000000000000000000000000000000000005d94e83"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(uint)" do
    type = "(uint256)"
    value = [98_127_491]
    data = hex "0000000000000000000000000000000000000000000000000000000005d94e83"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "int" do
    type = "int256"
    value = -100
    data = hex "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9c"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(int)" do
    type = "(int256)"
    value = [-100]
    data = hex "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9c"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "bool" do
    type = "bool"
    value = false
    data = hex "0000000000000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(bool)" do
    type = "(bool)"
    value = [false]
    data = hex "0000000000000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "string" do
    type = "string"
    value = "Hello World"
    data = hex "000000000000000000000000000000000000000000000000000000000000000b" \
               "48656c6c6f20576f726c64000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(string)" do
    type = "(string)"
    value = ["Hello World"]
    data = hex "0000000000000000000000000000000000000000000000000000000000000020" \
               "000000000000000000000000000000000000000000000000000000000000000b" \
               "48656c6c6f20576f726c64000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "bytes" do
    type = "bytes"
    value = hex("0x12345678")
    data = hex "0000000000000000000000000000000000000000000000000000000000000004" \
               "1234567800000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(bytes)" do
    type = "(bytes)"
    value = [hex("0x12345678")]
    data = hex "0000000000000000000000000000000000000000000000000000000000000020" \
               "0000000000000000000000000000000000000000000000000000000000000004" \
               "1234567800000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "bytes4" do
    type = "bytes4"
    value = hex("0x12345678")
    data = hex "1234567800000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "bytes4 - 2" do
    type = "bytes4"
    value = "1234".b
    data = hex "3132333400000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(bytes4)" do
    type = "(bytes4)"
    value = [hex("0x12345678")]
    data = hex "1234567800000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end

  it "(bytes4) - encoding from hex string" do
    type = "(bytes4)"
    value = ["0x12345678"]
    data = hex "1234567800000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
  end

  it "(bytes32,(address,uint256,uint256,address,uint256,address,uint256,bytes))" do
    type = "(bytes32,(address,uint256,uint256,address,uint256,address,uint256,bytes))"
    value = [
      hex("2628abe10aaf809f0ea9a33fb15782582e8d8353ea15698d7067b057748581a4"),
      [
        "00000000001523057a05d6293c1e5171ee33ee0a",
        195,
        421_614,
        "0000000000d2de3e2444926c4577b0a59f1dd8bc",
        44,
        "0000000000d2de3e2444926c4577b0a59f1dd8bc",
        473_508,
        hex("394d1bca0000000000000000000000000b001c95e86d64c1ad6e43944c568a6c31b538870000000000000000000000000b001c95e86d64c1ad6e43944c568a6c31b53887000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000090841287191622077700000000000000000000000000000000000000000000000")
      ]
    ]
    data = hex "2628abe10aaf809f0ea9a33fb15782582e8d8353ea15698d7067b057748581a4000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000001523057a05d6293c1e5171ee33ee0a00000000000000000000000000000000000000000000000000000000000000c30000000000000000000000000000000000000000000000000000000000066eee0000000000000000000000000000000000d2de3e2444926c4577b0a59f1dd8bc000000000000000000000000000000000000000000000000000000000000002c0000000000000000000000000000000000d2de3e2444926c4577b0a59f1dd8bc00000000000000000000000000000000000000000000000000000000000739a4000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000a4394d1bca0000000000000000000000000b001c95e86d64c1ad6e43944c568a6c31b538870000000000000000000000000b001c95e86d64c1ad6e43944c568a6c31b5388700000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000009084128719162207770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

    expect(encode(type, value)).to eq data
    expect(decode(type, data)).to eq value
  end
end
